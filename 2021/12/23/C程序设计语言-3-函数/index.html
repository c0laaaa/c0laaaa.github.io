<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="C语言,学习笔记," />










<meta name="description" content="《C程序设计语言》第四章函数的学习笔记 介绍了一些函数的声明，外部变量，标识符等 还有宏替换，条件编译等">
<meta property="og:type" content="article">
<meta property="og:title" content="C程序设计语言_3_函数">
<meta property="og:url" content="https://c0laaaa.github.io/2021/12/23/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80-3-%E5%87%BD%E6%95%B0/index.html">
<meta property="og:site_name" content="c0laaaa&#39;blogs">
<meta property="og:description" content="《C程序设计语言》第四章函数的学习笔记 介绍了一些函数的声明，外部变量，标识符等 还有宏替换，条件编译等">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-23T01:48:23.000Z">
<meta property="article:modified_time" content="2021-12-23T02:18:33.879Z">
<meta property="article:author" content="c0laaaa">
<meta property="article:tag" content="C语言">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://c0laaaa.github.io/2021/12/23/C程序设计语言-3-函数/"/>





  <title>C程序设计语言_3_函数 | c0laaaa'blogs</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">c0laaaa'blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">热爱生活</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://c0laaaa.github.io/2021/12/23/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80-3-%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="c0laaaa'blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">C程序设计语言_3_函数</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-12-23T09:48:23+08:00">
                2021-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <ul>
<li>《C程序设计语言》第四章函数的学习笔记</li>
<li>介绍了一些函数的声明，外部变量，标识符等</li>
<li>还有宏替换，条件编译等</li>
</ul>
<hr>
<span id="more"></span>

<h1 id="C程序设计语言-3"><a href="#C程序设计语言-3" class="headerlink" title="C程序设计语言_3"></a>C程序设计语言_3</h1><h2 id="函数与程序结构"><a href="#函数与程序结构" class="headerlink" title="函数与程序结构"></a>函数与程序结构</h2><ul>
<li>函数可以把大的计算任务分解为若干个较小的任务，程序设计人员可以基于函数进一步构造程序，而不需要重新编写一些代码。</li>
<li>一个设计得当的函数可以把程序中不需要了解的具体操作细节隐藏起来，从而使整个程序接哦古更加清晰，并降低修改程序的难度。</li>
<li>C语言程序一般都由许多较小的函数组成，而不是由少量较大的函数组成。</li>
<li>一个程序可以保存在一个或多个源文件中。各个文件可以单独编译，并可以与库中已编译过的函数一起加载。</li>
</ul>
<h3 id="函数基本知识"><a href="#函数基本知识" class="headerlink" title="函数基本知识"></a>函数基本知识</h3><p>​    首先，我们设计并编写一个程序，它将输入中包含特定“模式”或字符串的各行打印出来，例如，要在下列一组文本行中查找包含字符串”ould”的行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ah Love! could you and I with Fate conspire</span><br><span class="line">To grasp this sorry Scheme of Things entire,</span><br><span class="line">Would not we shatter it to bits -- and then</span><br><span class="line">Re-mould it nearer to the Heart&#x27;s Desire!</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    程序执行后输出下列结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ah Love! could you and I with Fate conspire</span><br><span class="line">Would not we shatter it to bits -- and then</span><br><span class="line">Re-mould it nearer to the Heart&#x27;s Desire!</span><br></pre></td></tr></table></figure>

<p>​    该任务可以明确地划分成下列3部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(还有未处理的行)</span><br><span class="line">	<span class="keyword">if</span>(该行包含指定的模式)</span><br><span class="line">		打印该行</span><br></pre></td></tr></table></figure>

<p>​    尽管我们可以把所有的代码都放到主程序main中，但更好的做法是，利用其结构把每部分设计成一个独立的函数。分别处理3个小的部分比处理一个大的整体更容易，因为这样，可以把不相关的细节隐藏在函数中，从而减少了不必要的相互影响的机会，并且，这些函数也可以在其他程序中使用。</p>
<p>​    我们用函数getline实现“还有未处理的行”，该函数已经在第一章中介绍过了，用printf实现“打印该行”，这个函数是现成的，别人已经提供了。也就是说，我们只需要编写一个判定”该行包含指定的模式“的函数。</p>
<p>​    我们编写函数strindex(s, t)实现该目标。该函数返回字符串t在字符串s中出现的起始位置或索引。当s不包含t时，返回值为-1。</p>
<p>​    由于C语言数组的下标从0开始，下标的值只可能为0或正数，因此可以用像-1这样的负数表示失败的情况。</p>
<p>​    如果以后需要进行更复杂的模式匹配，只需要替换strindex函数即可，程序的其余部分可以保持不变。</p>
<p>​    下面是一个完整的程序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE 1000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getline</span><span class="params">(<span class="keyword">char</span> line[], <span class="keyword">int</span> max)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strindex</span><span class="params">(<span class="keyword">char</span> source[], <span class="keyword">char</span> searchfor[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> pattern[] = <span class="string">&quot;ould&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> line[MAXLINE];</span><br><span class="line">	<span class="keyword">int</span> found = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(getline(line), MAXLINE)&#123;</span><br><span class="line">		<span class="keyword">if</span>(strindex(line, pattern) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, line);</span><br><span class="line">			found++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> found;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getline</span><span class="params">(<span class="keyword">char</span> line[], <span class="keyword">int</span> max)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, c;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; max - <span class="number">1</span> &amp;&amp; (c = getchar()) != EOF &amp;&amp; c != <span class="string">&#x27;\n&#x27;</span>; i++)</span><br><span class="line">        line[i] = c;</span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;\n&#x27;</span>)&#123;</span><br><span class="line">        line[i] = c;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    line[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> i; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strindex</span><span class="params">(<span class="keyword">char</span> s[], <span class="keyword">char</span> t[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; s[i] != <span class="string">&#x27;\0&#x27;</span>, i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(j = i, k = <span class="number">0</span>; t[k] != <span class="string">&#x27;\0&#x27;</span> &amp;&amp; s[j] == t[k]; j++, k++)</span><br><span class="line">            ;</span><br><span class="line">        <span class="keyword">if</span>(k &gt; <span class="number">0</span> &amp;&amp; t[k] == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    函数的定义形式如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">返回值类型 函数名(参数声明列表)&#123;</span><br><span class="line">	声明和语句</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    函数定义中的各构成部分都可以省略。最简单的函数如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dummy()&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>​    该函数不执行任何操作也不返回任何值。这种不执行任何操作的函数有时候很有用，它可以在程序开发期间用以保留位置。<strong>如果函数定义中省略了返回值类型，则默认为int类型。</strong></p>
<p>​    程序可以看成是变量定义和函数定义的集合。函数之间的通信可以通过参数，函数返回值以及外部变量进行。函数在源文件出现的次序可以是任意的。只要保证每一个函数不被分离到多个文件中，源程序就可以分成多个文件。</p>
<ul>
<li><p>被调用函数通过return语句向调用者返回值，return语句的后面可以跟任何表达式，在必要的时候，表达式将被转换为函数的返回值类型。表达式两边通常加一对圆括号，此处的括号是可选的。</p>
</li>
<li><p>调用函数可以忽略返回值。并且，return语句的后面也不一定需要表达式。当return语句的后面没有表达式时，函数将不向调用者返回值。</p>
</li>
<li><p>当被调用函数执行到最后的花括号而结束执行时，控制同样也会返回给调用者。如果某个函数从一个地方返回时有返回值，而从另一个地方返回时，没有返回值，该函数并不非法。</p>
</li>
</ul>
<p>​    在上面的模式查找程序中，主程序main返回了一个状态，即匹配的数目。该返回值可以在调用该程序的环境中使用。</p>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><p>编写函数strindex(s, t)，它返回字符串t在s中最右边出现的位置。如果s中不包含t，则返回-1。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strindex</span><span class="params">(<span class="keyword">char</span> s[],<span class="keyword">char</span> t[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k;</span><br><span class="line">    <span class="keyword">int</span> state, place;</span><br><span class="line"></span><br><span class="line">    place = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; s[i] != <span class="string">&#x27;\0&#x27;</span>; ++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>, k = <span class="number">0</span>; t[k] != <span class="string">&#x27;\0&#x27;</span> &amp;&amp; t[k] == s[i+j]; ++j, ++k)</span><br><span class="line">            ;</span><br><span class="line">        <span class="keyword">if</span>(t[k] == <span class="string">&#x27;\0&#x27;</span> &amp;&amp; k &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            place = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> place;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><p>​    许多数值函数（如sqrt，sin与cos等函数）返回的是double类型的值，某些专用函数则返回其它类型的值。我们通过函数atof(s)来说明函数返回非整形值的方法。该函数把字符串s转换为相应的双精度浮点数。atof(s)函数是atoi函数的扩展，atof函数需要处理可选的符号和小数点，并要考虑可能缺少整数部分或小数部分的情况。</p>
<p>​    首先，由于atof函数的返回值类型不是int，因此，该函数必须声明返回值的类型。返回值类型应该放在函数名字之前，如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">atof</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> val, power;</span><br><span class="line">	<span class="keyword">int</span> i, sign;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; <span class="built_in">isspace</span>(s[i]); i++)</span><br><span class="line">		;</span><br><span class="line">	sign = (s[i] == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(s[i] == <span class="string">&#x27;+&#x27;</span> || s[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">		i++;</span><br><span class="line">    <span class="comment">//处理整数部分</span></span><br><span class="line">	<span class="keyword">for</span>(val = <span class="number">0.0</span>; <span class="built_in">isdigit</span>(s[i]); i++)</span><br><span class="line">		val = <span class="number">10.0</span> * val + (s[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(s[i] == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">		i++;</span><br><span class="line">    <span class="comment">//处理小数部分，计算有多少小数位，然后除以10的倍数</span></span><br><span class="line">	<span class="keyword">for</span>(power = <span class="number">1.0</span>; isdigits(s[i]); i++)&#123;</span><br><span class="line">		val = <span class="number">10.0</span> * val + (s[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		power *= <span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> sign * val / power;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    其次，<em><strong>调用函数必须知道atof函数返回的是非整型值，这一点也很重要。为了达到该目的，一种方法是在调用函数中显示声明atof函数。</strong></em>下面所示的基本计算器程序中有类似的声明。该程序在每一行中读取一个数，并对它们求和，在每次输入完成后，把这些数的累计总和打印出来：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE 100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> sum, atof(<span class="keyword">char</span> []);</span><br><span class="line">	<span class="keyword">char</span> line[MAXLINE];</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getline</span><span class="params">(<span class="keyword">char</span> line[], <span class="keyword">int</span> max)</span></span>;</span><br><span class="line">	</span><br><span class="line">	sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(getline(line, MAXLINE) &gt; <span class="number">0</span>)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\t%g\n&quot;</span>, sum += atof(line));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    其中，声明语句</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> sum, atof(<span class="keyword">char</span> []);</span><br></pre></td></tr></table></figure>

<p>​    表明sum是一个double类型的变量，atof函数带有一个char[]类型的参数，并且返回一个double类型的值。</p>
<p>​    函数atof的声明与定义必须一致。如果atof函数与调用它的主函数main放在同一源文件中，并且类型不一致，编译器就会检测到该错误。但是，如果atof函数是单独编译的，这种不匹配的错误就无法检测出来。</p>
<p>​    如果没有函数原型，则函数将在第一次出现的表达式中被隐式声明，例如：sum += atof(line)，如果先前没有声明过的一个名字出现在某个表达式中，并且其后紧跟一个左圆括号，那么上下文就会认为该名字是一个函数名字，该函数的返回值被假定为int类型，但上下文并不对其参数作任何假设。并且，如果函数声明中不包含参数，例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">atof</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>​    那么编译程序，也不会对函数atof的参数作出任何假设，并会关闭所有的参数检查。</p>
<h4 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h4><p>对atof函数进行扩充，使它可以处理形如123.45e-6的科学表示法，其中，浮点数后面可能会紧跟一个e或E以及一个指数（可能有正负号）</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">atof</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> val, power;</span><br><span class="line">	<span class="keyword">int</span> sign_val, sign_exp, <span class="built_in">exp</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; <span class="built_in">isspace</span>(s[i]); ++i)</span><br><span class="line">		;</span><br><span class="line">	sign_val = (s[i] == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(s[i] == <span class="string">&#x27;-&#x27;</span> || s[i] == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">		++i;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(val = <span class="number">0</span>; <span class="built_in">isdigit</span>(s[i]); i++)&#123;</span><br><span class="line">		val = val * <span class="number">10</span> + s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">if</span>(s[i] == <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">		i++;</span><br><span class="line">		<span class="keyword">for</span>(power = <span class="number">1</span>; <span class="built_in">isdigit</span>(s[i]); i++)&#123;</span><br><span class="line">			val = val * <span class="number">10</span> + s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">			power *= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	val = sign_val * val / power;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(s[i] == <span class="string">&#x27;e&#x27;</span> || s[i] == <span class="string">&#x27;E&#x27;</span>)&#123;</span><br><span class="line">		i++;</span><br><span class="line">		sign_exp = (s[i] == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(s[i] == <span class="string">&#x27;+&#x27;</span> || s[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">			i++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="built_in">exp</span> = <span class="number">0</span>; <span class="built_in">isdigit</span>(s[i]); ++i)</span><br><span class="line">			<span class="built_in">exp</span> = <span class="built_in">exp</span> * <span class="number">10</span> + s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(sign_exp)</span><br><span class="line">			<span class="keyword">while</span>(epx-- &gt; <span class="number">0</span>)</span><br><span class="line">				val *= <span class="number">10</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">while</span>(epx-- &gt; <span class="number">0</span>)</span><br><span class="line">				val /= <span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="外部变量"><a href="#外部变量" class="headerlink" title="外部变量"></a>外部变量</h3><ul>
<li>C语言程序可以看成由一系列的外部对象构成，这些外部对象可能是变量或函数。</li>
<li>外部变量定义在函数之外，因此可以在许多函数中使用。</li>
<li>由于C语言不允许在一个函数中定义其他函数，因此函数本身是外部的。</li>
<li>默认情况下，外部变量与函数具有下列性质：通过同一个名字对外部变量的多有引用，（即使这种引用来自于单独编译的不同函数）实际上都是引用同一个对象（标准中把这一性质称为外部链接）。</li>
<li>后面会介绍如何定义只能在某一个源文件中使用的外部变量与函数。</li>
</ul>
<p>​    因为外部变量可以在全局范围内访问，这就为函数之间的数据交换提供了一种可以代替函数参数与返回值的方式。<em><strong>任何函数都可以通过名字访问一个外部变量，当然这个名字需要通过某种方式进行声明。</strong></em></p>
<p>​    如果函数之间需要共享大量的变量，使用外部变量要比用一个很长的参数列表更方便，有效。但是这样做也可能会导致程序中各个函数之间具有太多的数据联系。</p>
<p>​    外部变量的用途还表现在它们与内部变量相比具有更大的作用域和更长的生存周期。自动变量只能在函数内部使用，从其所在函数被调用时开始存在，在函数退出时变量也将消失，外部变量是永久存在的，它们的值在一次函数调用到下一次函数调用之间保持不变。</p>
<p>​    因此，如果两个函数必须共享某些数据，而这两个函数互不调用对方，这种情况下最方便的做法是把这些共享数据定义为外部变量，而不是作为函数参数传递。</p>
<p>​    下面我们通过一个更加复杂的例子来说明这一点。我们的目标是编写一个具有加(+)，减(-)，乘(*)，除(/)四则运算功能的计算器程序。为了更容易实现，我们在计算器中使用逆波兰表示法代替普通的中缀表示法。</p>
<p>​    在逆波兰表示法中，所有运算符都跟在操作数的后面。比如，下列中缀表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1 - 2) * (4 + 5)</span><br></pre></td></tr></table></figure>

<p>​    采用逆波兰表示法表示为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 - 4 5 + *</span><br></pre></td></tr></table></figure>

<p>​    逆波兰表示法中，不需要圆括号，只需要知道每个运算符有几个操作数就不会引起歧义。</p>
<p>​    计算器程序的实现很简单。每个操作数都被依次压入栈中；当一个运算符到达时，从栈中弹出相应数目的操作数（对二元运算符来说是两个操作数），把该运算符作用于弹出的操作数，并把运算结果再压入栈中。</p>
<p>​    例如，对于上面的逆波兰表达式来说，首先把1和2压入栈中，再用两者之差-1取代它们，然后把4和5压入栈中，然后再用两者之和9来取代它们，最后，从栈中取出栈顶的-1和9，并把它们的积-9压入栈中。到达输入行末尾时，把栈顶的值弹出。</p>
<p>​    这样，该程序的结构就构成了一个循环，每次循环对一个运算符以及相应的操作数执行依次操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(下一个运算符或操作数不是文件结尾指示符)&#123;</span><br><span class="line">	<span class="keyword">if</span>(是数)</span><br><span class="line">		将该数压入栈中</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(是运算符)</span><br><span class="line">		弹出所需数目的操作数</span><br><span class="line">		执行运算</span><br><span class="line">		将结果压入栈中</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(是换行符)</span><br><span class="line">		弹出并打印栈顶的值</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		出错</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    栈的压入于弹出操作比较简单，但是，如果把错误检测与恢复操作都加进来，该程序就显得很长了，最好把它们设计成独立的函数，而不要把它们作为程序中重复的代码段使用。另外还需要一个单独的函数来取下一个输入运算符或操作数。</p>
<p>​    到目前为止，我们还没有讨论设计中的一个重要问题：把栈放在哪里？也就是，哪些函数可以直接访问它？一种可能是把它放在main函数中，把栈和当前位置作为参数传递给对它执行压入或弹出的函数。但是，main函数不需要了解控制栈的变量信息，它只进行压入与弹出操作。因此，可以把栈和相关信息放在外部变量中，并只供push与pop函数访问，而不能被main函数访问。    </p>
<p>​    把上面这段话转换成代码很容易。如果把该程序放在一个源文件中，程序可能类似于下列形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include ...</span><br><span class="line">#define ...</span><br><span class="line">main使用的函数声明</span><br><span class="line">main()&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">push和pop所使用的外部变量</span><br><span class="line">void push(double f) &#123; ... &#125;</span><br><span class="line">double pop(void) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">int gettop(char s[]) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">被gettop调用的函数</span><br></pre></td></tr></table></figure>

<p>​    main函数包括一个很大的switch的循环，该循环根据运算符或操作数的类型控制程序的转移。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXOP 1000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER <span class="meta-string">&#x27;0&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXVAL 100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pop</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">double</span> f)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">char</span> s[MAXOP];</span><br><span class="line">    <span class="keyword">double</span> op2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>((type = getop(s)) != EOF)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(type)&#123;</span><br><span class="line">            <span class="keyword">case</span> NUMBER:</span><br><span class="line">                push(atof(s));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                push(pop() + pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                push(pop() - op2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                push(pop() * pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                <span class="keyword">if</span>(op2 != <span class="number">0.0</span>)</span><br><span class="line">                    push(pop() / op2);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;error: zero divisor\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%.8g\n&quot;</span>, pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;error: unknown command %s\n&quot;</span>, s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> val[MAXVAL];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pop</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(sp &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> val[--sp];</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error: stack empty\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">double</span> f)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(sp &lt; MAXVAL)</span><br><span class="line">        val[sp++] = f;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error: stack full\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span> c)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取到第一个不是空白符号的字符然后截断</span></span><br><span class="line">    <span class="keyword">while</span>((s[<span class="number">0</span>] = c = getch()) == <span class="string">&#x27; &#x27;</span> || c == <span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        ;</span><br><span class="line">    s[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断这个第一个不是空白符号的字符是否是数字字符或数字字符的一部分</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果这个第一个不是空白符号的字符是数字字符或数字字符的一部分</span></span><br><span class="line">    <span class="comment">// 那么就从这个字符后的第二个字符开始将数字字符写入到s中</span></span><br><span class="line">    <span class="comment">// 第一个字符已经写入到s中了</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isdigit</span>(c))&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 顶替了最后一个不是数字的字符</span></span><br><span class="line">    s[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果不等于EOF，那么说明还会继续进行，那么这个字符不能被&quot;吃掉&quot;</span></span><br><span class="line">    <span class="comment">// 如果等于EOF，那么程序结束，这个EOF字符被吃掉了也无所谓了</span></span><br><span class="line">    <span class="keyword">if</span>(c != EOF)</span><br><span class="line">        ungetch(c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> NUMBER;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFSIZE 100</span></span><br><span class="line"><span class="keyword">int</span> buf[BUFFSIZE];</span><br><span class="line"><span class="keyword">int</span> bufp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果缓冲区中有字符，优先输出缓冲区中的字符</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (bufp &gt; <span class="number">0</span>) ? buf[--bufp] : getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果缓冲区满了就报错，没满就回收丢失的字符</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(bufp &gt;= BUFFSIZE)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ungetch: too many characters\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        buf[bufp++] = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h4><ul>
<li><p>有了基本框架后，对计算器程序进行扩展就比较简单了。在该程序中加入取模运算符，并注意考虑负数的情况。</p>
<p>这里涉及到两个问题，一个是double类型的数的取模问题，一个是负数的符号和减号的区分问题。</p>
<p>double数的取模问题是使用math.h头文件中的fmod函数。</p>
<p>负数和减号区分的问题如下,只需要改写getop函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c, i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得前面的空白符号</span></span><br><span class="line">    <span class="keyword">while</span>((s[<span class="number">0</span>] = c = getch()) == <span class="string">&#x27; &#x27;</span> || c == <span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        ;</span><br><span class="line">    s[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">&#x27;.&#x27;</span> &amp;&amp; c != <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 如果负号的下一个字符是数字字符或小数点，读取到s中，继续程序</span></span><br><span class="line">    <span class="comment">// 否则，退回这个符号，然后返回减号</span></span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isdigit</span>((c = getch())) || c == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">            s[++i] = c;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ungetch(c);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数字字符读取进字符串s</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isdigit</span>(c))&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不能和上面的合并，次序很重要</span></span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    ungetch(c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> NUMBER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在栈操作中，添加几个命令，分别用于在不弹出元素的情况下打印栈顶元素；复制栈顶元素；交换栈顶元素的两个值。另外增加一个命令用于清空栈。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主程序中添加一个op2变量，然后switch语句中添加下分支:</span></span><br><span class="line">			<span class="comment">// 用于不弹出元素情况下打印栈顶元素</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%.8g\n&quot;</span>, op2);</span><br><span class="line">                push(op2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">			<span class="comment">// 用于复制栈顶元素</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                push(op2);</span><br><span class="line">                push(op2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">			<span class="comment">// 用于交换栈顶两个元素的值</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                op1 = pop();</span><br><span class="line">                op2 = pop();</span><br><span class="line">                push(op2);</span><br><span class="line">                push(op1);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">			<span class="comment">// 清空栈</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">                clear();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个函数clear()用于清空栈:</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    sp = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>给计算器程序增加访问sin，exp与pow等库函数的操作。</p>
<p>这里有新增的操作符号，也就是数学操作符号，它是一个字符串，那么我们可以新增加一个专门用来处理数学操作符号的函数mathfnc。</p>
<p>我们这里认为一个不是数字字符串的字符串就是一个数学操作符号，那么我们的getop函数就要增加一个功能。同样的也要在main函数的switch中设置相应的分支</p>
<p>修改后如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main函数：</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXOP 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER <span class="meta-string">&#x27;0&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">&#x27;n&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> [])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pop</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mathfnc</span><span class="params">(<span class="keyword">char</span> [])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> type;</span><br><span class="line">	<span class="keyword">double</span> op2;</span><br><span class="line">	<span class="keyword">char</span> s[MAXOP];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>((type = getop(s)) != EOF)&#123;</span><br><span class="line">		<span class="keyword">switch</span>(type)&#123;</span><br><span class="line">			<span class="keyword">case</span> NUMBER:</span><br><span class="line">                push(atof(s));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> NAME:</span><br><span class="line">            	mathfnc(s);</span><br><span class="line">            	<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                push(pop() + pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                push(pop() - op2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                push(pop() * pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                <span class="keyword">if</span> (op2 == <span class="number">0.0</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;error: zero divisor&quot;</span>);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    push(pop() / op2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%.8g\n&quot;</span>, pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;error: unknown command %s \n&quot;</span>, s);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mathfnc</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> op2;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strcmp</span>(s, <span class="string">&quot;sin&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		push(<span class="built_in">sin</span>(pop()));</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(s, <span class="string">&quot;cos&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		push(<span class="built_in">cos</span>(pop()));</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(s, <span class="string">&quot;exp&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		push(<span class="built_in">exp</span>(pop()));</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(s, <span class="string">&quot;pow&quot;</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">		op2 = pop();</span><br><span class="line">		push(<span class="built_in">pow</span>(pop(), op2));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;error: %s not supported\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改后的getop函数</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> c, i;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>((s[<span class="number">0</span>] = c = getch()) == <span class="string">&#x27; &#x27;</span> || c == <span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">		;</span><br><span class="line">	s[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 处理数学命令</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">islower</span>(c))&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">islower</span>(s[++i] = c = getch()))</span><br><span class="line">			;</span><br><span class="line">		s[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">		ungetch(c);</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strlen</span>(s) &gt; <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span> NAME;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> c;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 处理负号</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">&#x27;.&#x27;</span> &amp;&amp; c != <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isdigit</span>((c = getch())) || c == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">            s[++i] = c;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ungetch(c);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isdigit</span>(c))&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    ungetch(c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> NUMBER;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>给计算器程序增加处理变量的命令(提供26个单个英文字母变量名的变量很容易)。增加一个变量存放最近打印的值。</p>
<p>只修改了main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;calc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXOP 100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, type, var;</span><br><span class="line">	<span class="keyword">int</span> last_type;</span><br><span class="line">	<span class="keyword">double</span> op2, v;</span><br><span class="line">	<span class="keyword">char</span> s[MAXOP];</span><br><span class="line">	<span class="keyword">double</span> variable[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">	v = <span class="number">0.0</span>;</span><br><span class="line">	var = <span class="number">0</span>;</span><br><span class="line">	last_type = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">		variable[i] = <span class="number">0.0</span>;</span><br><span class="line">	<span class="keyword">while</span>((type = getop(s)) != EOF)&#123;</span><br><span class="line">		<span class="keyword">switch</span> (type)&#123;</span><br><span class="line">			<span class="keyword">case</span> NUMBER:</span><br><span class="line">				push(atof(s));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> NAME:</span><br><span class="line">                mathfnc(s);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">				push(pop() + pop());</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">				push(pop() * pop());</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">				op2 = pop();</span><br><span class="line">				push(pop() - op2);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">				op2 = pop();</span><br><span class="line">				<span class="keyword">if</span>(op2 != <span class="number">0.0</span>)</span><br><span class="line">					push(pop() / op2);</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;error: zero divisor\n&quot;</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">				pop();</span><br><span class="line">				<span class="keyword">if</span>(var &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; var &lt;= <span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line">					variable[var - <span class="string">&#x27;A&#x27;</span>] = pop();</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;error: no variable name\n&quot;</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">				<span class="keyword">if</span>(last_type != <span class="string">&#x27;l&#x27;</span> &amp;&amp; last_type != <span class="string">&#x27;=&#x27;</span>)&#123;</span><br><span class="line">					v = pop();</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;result is %.8g\n&quot;</span>, v);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(last_type == <span class="string">&#x27;=&#x27;</span>)&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;value had been assigned\n&quot;</span>);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="keyword">if</span>(type &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; type &lt;= <span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line">					push(variable[type - <span class="string">&#x27;A&#x27;</span>]);</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(type == <span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">					push(v);</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;error: unknown command %s\n&quot;</span>, s);</span><br><span class="line">		&#125;</span><br><span class="line">		var = type;</span><br><span class="line">		last_type = type;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写一个函数ungets(s)，将整个字符串压回到输入s中。ungets函数需要使用buf和bufp吗？它能否仅使用ungetch函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungets</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="built_in">strlen</span>[s];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">	<span class="keyword">while</span>(len &gt; <span class="number">0</span>)</span><br><span class="line">		ungetch(s[--len]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>假设最多只压回一个字符，请相应地修改getch和ungetch这两个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">if</span>(c != <span class="number">0</span>)</span><br><span class="line">		d = c;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		d = getchar();</span><br><span class="line">    c = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(c == <span class="number">0</span>)</span><br><span class="line">        c = d;</span><br><span class="line">   	<span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error: too many characters\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>另一种方法是通过getline函数读入整个输入行，这种情况下可以不使用getch与ungetch函数。请运用这一方法修改计算器程序。</p>
<p>这里就只修改getop函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE 1000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_getline</span><span class="params">(<span class="keyword">char</span> [], <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> line[MAXLINE];</span><br><span class="line"><span class="keyword">int</span> li = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> c, i;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//读取一行字符</span></span><br><span class="line">	<span class="keyword">if</span>(line[li] == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span>(my_getline(line, MAXLINE) == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> EOF;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			li = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 丢弃空白字符</span></span><br><span class="line">	<span class="keyword">while</span>((c = s[<span class="number">0</span>] = line[li++]) == <span class="string">&#x27; &#x27;</span> || c == <span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">		;</span><br><span class="line">	s[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 判断读取的第一个非空白字符类型</span></span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 开始读取操作数</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">isdigit</span>(c))</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">isdigit</span>(c = s[++i] = line[li++]))</span><br><span class="line">			;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(c == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">isdigit</span>(c = s[++i] = line[li++]))</span><br><span class="line">			;</span><br><span class="line">	</span><br><span class="line">	li--;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> NUMBER;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_getline</span><span class="params">(<span class="keyword">char</span> line[], <span class="keyword">int</span> lim)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> c, i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lim - <span class="number">1</span> &amp;&amp; (c = getchar()) != EOF &amp;&amp; c != <span class="string">&#x27;\n&#x27;</span>; ++i)</span><br><span class="line">		line[i] = c;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(c == <span class="string">&#x27;\n&#x27;</span>)&#123;</span><br><span class="line">		line[i] = c;</span><br><span class="line">		++i;</span><br><span class="line">	&#125;</span><br><span class="line">	line[i] = EOF;</span><br><span class="line">	<span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>修改getop函数，使其不必使用ungetch函数。</p>
<p>使用了一个static类型的内置变量解决该问题：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> lastc = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(lastc == <span class="number">0</span>)</span><br><span class="line">    	c = getch();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">    	c = lastc;</span><br><span class="line">    	lastc = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取到第一个不是空白符号的字符然后截断</span></span><br><span class="line">    <span class="keyword">while</span>((s[<span class="number">0</span>] = c) == <span class="string">&#x27; &#x27;</span> || c == <span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        c = getch();</span><br><span class="line">    s[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断这个第一个不是空白符号的字符是否是数字字符或数字字符的一部分</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果这个第一个不是空白符号的字符是数字字符或数字字符的一部分</span></span><br><span class="line">    <span class="comment">// 那么就从这个字符后的第二个字符开始将数字字符写入到s中</span></span><br><span class="line">    <span class="comment">// 第一个字符已经写入到s中了</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isdigit</span>(c))&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">isdigit</span>(s[++i] = c = getch()))</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 顶替了最后一个不是数字的字符</span></span><br><span class="line">    s[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	lastc = c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> NUMBER;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFSIZE 100</span></span><br><span class="line"><span class="keyword">int</span> buf[BUFFSIZE];</span><br><span class="line"><span class="keyword">int</span> bufp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果缓冲区中有字符，优先输出缓冲区中的字符</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (bufp &gt; <span class="number">0</span>) ? buf[--bufp] : getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="作用域规则"><a href="#作用域规则" class="headerlink" title="作用域规则"></a>作用域规则</h3><ul>
<li>构成C语言程序的函数与外部变量可以分开进行编译。</li>
<li>一个程序可以存放在几个文件中，原先已编译过的函数可以从库中进行加载。</li>
</ul>
<p>下面关于我们的计算器程序提出几个问题：</p>
<ol>
<li>如何进行声明才能确保变量在编译时被正确地声明</li>
<li>如何安排声明的位置才能确保程序在加载时各部分能正确连接</li>
<li>如何组织程序中的声明才能确保只有一份副本</li>
<li>如何初始化外部变量</li>
</ol>
<p>名字的<strong>作用域</strong>指的是程序中可以使用该名字的部分。</p>
<p>对于在函数开头声明的自动变量来说，其作用域是声明该变量名的函数。</p>
<p>不同函数中声明的具有相同名字的各个局部变量没有任何关系，函数的参数可以看作是函数的局部变量。</p>
<p>外部变量或函数的作用域从<em><strong>声明它的地方开始</strong></em>（是声明，不是定义，函数原型是声明），到其所在的文件（待编译）的末尾结束。</p>
<p>例如，如果main, sp, val, push与pop是依次定义在某个文件中的5个函数或外部变量，如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">main()&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> val[MAXVAL];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">double</span> f)</span></span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pop</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么，在push与pop这两个函数中不需要进行任何地声明就可以通过名字访问变量sp与val，但是，这两个变量名不能用在main函数中，push与pop两个函数也不能用在main函数中。</p>
<p><em><strong>另一方面，如果要在外部变量的定义之前使用该变量，或者外部变量的定义与变量的使用不在一个源文件中，则必须在相应的变量声明中强制性地使用关键字extern。</strong></em></p>
<p>将外部变量的声明与定义严格区分开很重要。<em><strong>变量声明用于说明变量的属性，而变量定义除此以外还将引起存储器的分配。</strong></em></p>
<p>如果将下列语句放在所有函数的外部：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sp;</span><br><span class="line"><span class="keyword">double</span> val[MAXVAL];</span><br></pre></td></tr></table></figure>

<p>那么这两条语句将<strong>会定义外部变量</strong>，sp与val，<strong>并为之分配存储单元</strong>，同时这两条语句还可以作为该源文件中其余部分的声明。</p>
<p>而下面两行语句：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> sp;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">double</span> val[];</span><br></pre></td></tr></table></figure>

<p>为源文件的其他部分<strong>声明了</strong>一个int类型的<strong>外部变量</strong>sp以及一个double数组类型的外部变量val，但这两个声明<strong>并没有建立变量或为它们分配存储单元。</strong></p>
<p>在一个源程序的所有源文件中<strong>，<em>一个外部变量只能在某个文件中定义一次</em></strong>，而其他文件可以通过extern声明来访问它（<em><strong>定义外部变量的源文件中也可以包含对该外部变量的extern声明</strong></em>）。</p>
<p><em><strong>外部变量的定义一定要指定数组的长度，但是extern声明则不一定要指定数组的长度。外部变量的初始化只能出现在其定义中。</strong></em></p>
<h3 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h3><p>某些变量，比如文件stack.c中定义的变量sp与val以及文件getch.c中定义的变量buf与bufp，它们<em><strong>仅供其所在的源文件中的函数使用，其他函数不能访问。用static声明限定外部变量与函数，可以将其后声明的对象的作用域限定为被编译源文件的剩余部分。</strong></em></p>
<p>外部的static声明通常多用于变量，当然，它也可以用于声明函数。通常情况下，函数名字是全局可访问的，对整个程序的各个部分而言都可见。但是，如果把函数声明为static类型，则该函数名除了对该函数声明所在的文件可见外，其他文件都无法访问。</p>
<p><em><strong>static也可用于声明内部变量。static类型的内部变量同自动变量一样，是某个特定函数的局部变量，只能在函数中使用，但它与自动变量不同的是，不管其所在函数是否被调用，它一直存在，而不像自动变量那样，随着所在函数的被调用和退出而存在和消失。</strong></em></p>
<p><strong>换句话说，<em>static类型的内部变量是一种只能在某个特定函数中使用但一直占据存储空间的变量。</em></strong></p>
<h3 id="寄存器变量"><a href="#寄存器变量" class="headerlink" title="寄存器变量"></a>寄存器变量</h3><p>register声明告诉编译器，它所声明的变量在程序中使用频率较高。其思想是，将register变量放在寄存器中，这样可以使程序更小，执行速度更快。但是编译器可以忽略次选项。</p>
<p>register声明的形式如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> x;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">char</span> c;</span><br></pre></td></tr></table></figure>

<p>register声明只适用于自动变量以及函数的形式参数。下面是函数形参的例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f(<span class="keyword">register</span> <span class="keyword">unsigned</span> m, <span class="keyword">register</span> <span class="keyword">long</span> n)&#123;</span><br><span class="line">	<span class="keyword">register</span> <span class="keyword">int</span> i;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际使用时，底层硬件环境的实际情况对寄存器变量的使用会有一些限制。每个函数中只有很少的变量可以保存在寄存器中，且只允许某些类型的变量。但是，过量的寄存器声明并没有坏处，编译器会忽略过量的或不支持的寄存器声明。另外，无论寄存器变量实际上是不是存放在寄存器中，它的地址都是不可访问的。在不同的机器中，对寄存器变量的数目和类型的具体限制也是不同的。</p>
<h3 id="程序块结构"><a href="#程序块结构" class="headerlink" title="程序块结构"></a>程序块结构</h3><p><em>C语言不允许在函数中<strong>定义</strong>函数。</em>但是，在函数中可以以程序块结构的形式定义变量。变量的声明除了可以紧跟在函数开始的花括号之后，还可以紧跟在任何其他标识复合语句开始的左花括号。<em><strong>以这种方式声明的变量可以隐藏程序块外与之同名的变量，</strong></em>它们没有任何关系，并在左花括号匹配的右花括号出现之前一直存在。</p>
<p>自动变量也可以隐藏同名的外部变量与函数。在下面的声明中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="keyword">int</span> y;</span><br><span class="line"></span><br><span class="line">f(<span class="keyword">double</span> x)&#123;</span><br><span class="line">	<span class="keyword">double</span> y;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数f内的变量x引用的时函数的参数，类型为double，而在函数外，x是int类型的外部变量。这段代码中的y也是如此。</p>
<p>虽然可以在函数中隐藏同名变量，但是我们应该避免这样做。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>在不进行显示初始化的情况下，外部变量和静态变量都将被初始化为0，而自动变量和寄存器变量的初值则没有定义。</p>
<p>定义标量变量时，可以在变量名后紧跟一个等号和一个表达式来初始化变量。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">char</span> squote = <span class="string">&#x27;\&#x27;;</span></span><br><span class="line"><span class="string">long day = 1000L * 60L * 60L * 24L</span></span><br></pre></td></tr></table></figure>

<p>对于外部变量与静态变量来说，初始化表达式必须时常量表达式，且只初始化一次（从概念上讲是在程序开始执行前进行初始化）。对于自动变量与寄存器变量来说，则在每次进入函数或程序块时都将初始化。</p>
<p>对于自动变量和寄存器变量来说，初始化表达式可以不是常量表达式：表达式中可以包含任意在此表达式之前已经定义了的值，包括函数调用。</p>
<p>数组的初始化时在声明后面紧跟一个初始化表达式列表，初始化表达式列表用花括号括起来，各初始化表达式之间通过逗号分隔。例如，如果要用一年中各月的天数初始化数组days，其变量的定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> days[] = &#123;<span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>当省略数组长度时，编译器将把花括号中初始化表达式的个数作为数组的长度。</strong>上面的例子中的数组长度为12。</p>
<p><strong>如果初始化表达式的个数比数组元素少，则对外部变量，静态变量，自动变量来说，没有初始化表达式的元素将被初始化为0。</strong></p>
<p><strong>如果初始化表达式的个数比数组元素多，则是错误的。</strong></p>
<p><strong>不能一次将一个初始化表达式指定给多个数组元素，也不能跳过前面的数组元素而直接初始化后面的数组元素。</strong></p>
<p><strong>字符数组的初始化比较特殊：可以用一个字符串来替代花括号括起来并用逗号分隔的初始化表达式序列。</strong></p>
<p>例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> pattern[] = <span class="string">&quot;ould&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>它和下面的声明是等价的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> pattern[] = &#123;<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;\0&#x27;</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>这种情况下，数组的长度是5（4个字符加上一个字符串结束符’\0’）。</p>
<h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><p>C语言中的函数可以递归调用，即函数可以直接或间接调用自身。</p>
<p>我们用快速排序算法来说明递归。</p>
<p>快速排序算法是：对于一个给定的数组，从中选择一个元素，以该元素为界将其余元素划分为两个子集，一个子集中的所有元素都小于该元素，另一个子集中的所有元素都大于或等于该元素。</p>
<p>对这样两个子集递归执行这一过程，当某个子集中的元素数小于2时，这个子集就不需要再次排序，终止递归。</p>
<p>下面有一个不是最快但是最简单的递归算法之一，在每次划分子集时，该算法总是选取各个子数组的中间元素。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_qsort</span><span class="params">(<span class="keyword">int</span> v[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, last;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> [], <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(left &gt;= right)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	swap(v, left, (left + right)/<span class="number">2</span>);</span><br><span class="line">	last = left;</span><br><span class="line">	<span class="keyword">for</span>(i = left+<span class="number">1</span>; i &lt;= right; i++)</span><br><span class="line">		<span class="keyword">if</span>(v[i] &lt; v[left])</span><br><span class="line">			swap(v, ++last, i);</span><br><span class="line">	swap(v, left, last);</span><br><span class="line">	my_qsort(v, left, last<span class="number">-1</span>);</span><br><span class="line">	my_qsort(v, last+<span class="number">1</span>, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> v[], <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> temp;</span><br><span class="line"></span><br><span class="line">	temp = v[i]; </span><br><span class="line">	v[i] = v[j];</span><br><span class="line">	v[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h4><p>​    运用printd函数的设计思想编写一个递归版本的itoa函数，即通过递归调用把整数转换为字符串。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">itoa</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">char</span> s[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">if</span>((n /= <span class="number">10</span>)</span><br><span class="line">		itoa(n / <span class="number">10</span>, s);</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">0</span>)</span><br><span class="line">            s[i++] = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	s[i++] = <span class="built_in">abs</span>(n) % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    s[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="C预处理器"><a href="#C预处理器" class="headerlink" title="C预处理器"></a>C预处理器</h3><p>C语言通过预处理器提供了一些语言功能。从概念上来讲，预处理器是编译过程中单独执行的第一个步骤。两个最常用的预处理器指令是#include指令和#define指令。还有一些其他的特性，比如条件编译与带参数的宏。</p>
<h4 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h4><p>文件包含指令使得处理大量的#define指令以及声明更加方便。在源文件中，任何形如#include “文件名”或#include &lt;文件名&gt;的行都将被替换为由文件名指定的文件的内容。 </p>
<p>如果文件名用引号引起来，则在源文件所在位置查找该文件；如果在该位置没有找到文件，或者如果文件名用尖括号括起来，则将根据相应的规则查找该文件，这个规则和编译器有关。</p>
<p>被包含的文件本身也可包含#include指令。</p>
<p>源文件的开始处通常都会有多个#include指令，它们用以包含常见的#define语句和extern声明，或从头文件中访问库函数的函数原型声明，比如&lt;stdio.h&gt;。</p>
<p>在大的程序中，#include指令是将所有声明捆绑在一起的较好的方法。它保证所有的源文件都具有相同的定义与变量声明，这样可以避免一些不必要的错误。</p>
<h4 id="宏替换"><a href="#宏替换" class="headerlink" title="宏替换"></a>宏替换</h4><p>宏定义的形式如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> 名字 替换文本</span></span><br></pre></td></tr></table></figure>

<p> 这是一种最简单的宏替换，后续所有出现名字记号的地方都将被替换为替换文本。</p>
<ul>
<li><p>#define指令中的名字与变量名的命名方式相同，替换文本可以是任意字符串。</p>
</li>
<li><p>通常情况下是#define指令占一行，替换文本是#define指令行尾部的所有剩余部分内容。</p>
</li>
<li><p>但是也可以把一个较长的宏定义分成若干行，这时需要在持续的行末尾加上一个反斜杠符\。</p>
</li>
<li><p>#define指令定义的名字的作用域从其定义点开始，到被编译的源文件的末尾处结尾。</p>
</li>
<li><p>宏定义中也可以用前面出现的宏定义。</p>
</li>
<li><p>宏定义只对记号进行，对括号中的字符串不起作用。</p>
<p>例如，如果YES是一个通过#define指令定义过的名字，则在printf(“YES”)或YESMAN中将不执行替换。</p>
</li>
<li><p>替换文本可以是任意的，</p>
</li>
</ul>
<p>例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> forever for(;;)</span></span><br></pre></td></tr></table></figure>

<p>该语句为无限循环定义了一个新名字forever。</p>
<ul>
<li>宏定义也可以带参数，这样可以对不同的宏调用使用不同的替换文本。</li>
</ul>
<p>例如，下列宏定义定义了一个宏max:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max(A,B) ((A) &gt; (B) ? (A) : (B))</span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以通过#undef指令取消名字的宏定义，这样做可以保证后续的调用是函数调用，而不是宏调用：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> getchar</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getchar</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>形式参数不能用带引号的字符串替换。但是，如果在替换文本中参数名以#作为前缀，则结果将被扩展为由实际参数替换该参数的带引号的字符串。</li>
</ul>
<p>例如，可以将它与字符串连接运算结合起来编写一个调试打印宏：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dprint(expr) printf(#expr <span class="meta-string">&quot; = %g\n&quot;</span>, expr)</span></span><br></pre></td></tr></table></figure>

<p>使用语句</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dprint(x/y);</span><br></pre></td></tr></table></figure>

<p>调用该宏时，该宏将被扩展为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;x/y&quot;</span> <span class="string">&quot; = %g\n&quot;</span>, x/y);</span><br></pre></td></tr></table></figure>

<p>其中的字符串被连接起来了，这样，该宏调用的效果等价于</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;x/y = %g\n&quot;</span>, x/y);</span><br></pre></td></tr></table></figure>

<p>在实际参数中，每个双引号”将被替换为\“，反斜杠\将被替换为\\，因此替换后的字符串是合法的字符串常量。</p>
<ul>
<li>预处理器运算符##为宏扩展提供了一种连接实际参数的手段。如果替换文本中的参数与##相邻，则该参数将被实际参数替换，##与前后的空白符将被删除，并对替换后的结果重新扫描。</li>
</ul>
<p>例如，下面定义的宏paster用于连接两个参数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> paster(front, back) front ## back</span></span><br></pre></td></tr></table></figure>

<p>因此，宏调用paste(name,1)的结果将创建记号name1。</p>
<h4 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h4><p>定义宏swap(t, x, y)以交换t类型的两个参数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(t, x, y) &#123;(t) temp; temp = (x); (x) = (y); (y) = temp;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="条件编译"><a href="#条件编译" class="headerlink" title="条件编译"></a>条件编译</h3><p>#if语句对其中的常量整型表达式（其中不能包含sizeof，类型转换运算符或enum常量）进行求值，若该表达式的值不等于0，则包含其后的各行，直到遇到#endif，#elif或#else语句为止。</p>
<p>在#if语句中可以使用表达式defined（名字），该表达式的值遵循下列规则：当名字已经定义时，其值为1；否则，其值为0。</p>
<p>例如，为了保证hdr.h文件的内容只被包含一次，可以将该文件的内容包含在下列形式的条件语句中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(HDR)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HDR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;hdr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>第一次包含头文件hdr.h时，将定义名字HDR，此后再次包含该头文件时，会发现该名字已经定义，这样将直接跳转到#endif处。</p>
<p>类似的方式也可以用来避免多次重复包含同一文件。</p>
<p>如果多个头文件能够一致地使用这种方式，那么，每个头文件都可以将它所依赖的任何头文件包含进来，用户不必考虑和处理头文件之间的各种依赖关系。</p>
<p>下面的这段预处理代码首先测试系统变量SYSTEM，然后根据该变量的值确定包含哪个版本的头文件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SYSTEM == SYSV</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> HDR <span class="meta-string">&quot;sysv.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> SYSTEM == BSD</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> HDR <span class="meta-string">&quot;bsd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> SYSTEM == MSDOS</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> HDR <span class="meta-string">&quot;msdos.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> HDR <span class="meta-string">&quot;default.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> HDR</span></span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag"># C语言</a>
          
            <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"># 学习笔记</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/12/21/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80-2-%E6%8E%A7%E5%88%B6%E6%B5%81/" rel="next" title="C程序设计语言_2_控制流">
                <i class="fa fa-chevron-left"></i> C程序设计语言_2_控制流
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/01/02/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80-4-%E6%8C%87%E9%92%88/" rel="prev" title="C程序设计语言_4_指针">
                C程序设计语言_4_指针 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80-3"><span class="nav-text">C程序设计语言_3</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E4%B8%8E%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84"><span class="nav-text">函数与程序结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="nav-text">函数基本知识</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0"><span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E"><span class="nav-text">函数声明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-1"><span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-text">外部变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-2"><span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%A7%84%E5%88%99"><span class="nav-text">作用域规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F"><span class="nav-text">静态变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E5%8F%98%E9%87%8F"><span class="nav-text">寄存器变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E5%9D%97%E7%BB%93%E6%9E%84"><span class="nav-text">程序块结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%92%E5%BD%92"><span class="nav-text">递归</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-3"><span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-text">C预处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-text">文件包含</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8F%E6%9B%BF%E6%8D%A2"><span class="nav-text">宏替换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-4"><span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91"><span class="nav-text">条件编译</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">c0laaaa</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
